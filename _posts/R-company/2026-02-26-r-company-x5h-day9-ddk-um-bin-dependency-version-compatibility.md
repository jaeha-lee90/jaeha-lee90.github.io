---
title: R사 X5H Day9 - ddk-um-bin 의존성과 KM/UM 버전 정합 실패 패턴
author: JaeHa
date: 2026-02-26 09:00:00 -0800
categories: [R사, X5H, Display, GPU]
tags: [R사, X5H, ddk-um-bin, pvrsrvkm, Bring-up]
---

Day9는 Day8의 커널 모듈 기준선을 이어서, 유저스페이스(`ddk-um-bin`)와 커널 모듈(`pvrsrvkm`) 사이 정합 실패를 조기에 차단하는 데 집중한다. 브링업 초반 GPU 이슈의 다수는 기능 결함보다 **KM/UM 조합 불일치**에서 시작된다.

## 핵심 요약

- `ddk-um-bin`은 EGL/GLES/Vulkan 사용자 라이브러리와 PVRSRV 유저 컴포넌트를 제공하고, 런타임에 `pvrsrvkm`과 ioctls/bridge ABI로 결합된다.
- 빌드는 통과해도 KM/UM 빌드 베이스(DDK 태그, bridge 생성 산출물, feature 플래그)가 다르면 초기화 단계에서 즉시 실패하거나 간헐 크래시가 발생한다.
- 초기 게이트는 **(1) 라이브러리 로딩 경로, (2) 드라이버 버전 문자열, (3) 서비스 연결/브리지 호출 성공** 3단계로 고정하는 것이 안전하다.

## 코드 포인트

1. **유저 라이브러리 배치와 로더 경로**
   - 점검 대상: `/vendor/lib64/egl`, `/vendor/lib64/hw`, `ld.config.txt`(또는 동등 설정)
   - 확인 포인트: 동일 SoC/빌드 변형에서 라이브러리 set이 섞이지 않았는지, 심볼 해석이 의도한 vendor 경로로 수렴하는지

2. **KM/UM 버전 핸드셰이크**
   - 점검 대상: `dmesg` 내 PVRSRV 초기화 로그, `logcat`의 EGL/GLES 초기화 로그
   - 확인 포인트: DDK 버전 문자열/빌드 ID 불일치, bridge init 실패, 서비스 attach 실패 메시지

3. **브리지 ABI와 생성 코드 세트 정합**
   - 점검 대상: KM 쪽 `generated/*_bridge` 세트와 UM 바이너리의 릴리스 페어링
   - 확인 포인트: 한쪽만 갱신된 상태(특히 재생성 누락)에서 ioctl 번호/구조체 기대치가 어긋나는 패턴

4. **런타임 최소 검증 시퀀스**
   - 순서: 부팅 → `pvrsrvkm` 로드 확인 → EGL 컨텍스트 생성 → 단일 렌더 submit
   - 목적: 성능/품질 이전에 “GPU 스택이 일관된 버전으로 붙는지”를 빠르게 판별

## 리스크

- BSP 업데이트 중 일부 바이너리만 교체되면 재현이 낮은 랜덤 크래시(앱 시작 시점/첫 렌더 시점)가 발생할 수 있다.
- 디버그/릴리스 혼합 배포 시 로더 경로 우선순위 문제로 다른 라이브러리가 선택되어 원인 추적이 어려워진다.
- KM/UM 불일치를 display ownership 이슈로 오판하면 Day10~11 분석의 방향이 어긋난다.

## 다음 액션

- X5H 기준 “허용된 KM/UM 페어”를 표로 고정(DDK 태그, 빌드 해시, 배포 이미지 버전 포함)한다.
- 부팅 직후 수집할 표준 로그 템플릿(`dmesg`, `logcat`, 라이브러리 목록)을 만들어 정합 실패를 1차 분류한다.
- Day10은 계획 순서대로 **`disfwk_fe` 인터페이스/흐름**을 분석하되, 입력 전제는 Day9 정합 통과 조합으로 제한한다.
